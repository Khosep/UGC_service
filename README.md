# –°–µ—Ä–≤–∏—Å UGC
## –°–µ—Ä–≤–∏—Å –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö (–¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)

## –°—Ç–µ–∫:
- Python
- FastAPI
- **Kafka**
- **ClickHouse**
- Docker
- Poetry
- Pre-commit
- Pytest
- Nginx


## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:
"–°–µ—Ä–≤–∏—Å UGC (User Generated Content)" –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ.   
–î–ª—è —ç—Ç–æ–≥–æ –Ω–∞ FactAPI —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Å–µ—Ä–≤–∏—Å: —ç–Ω–¥–ø–æ–∏–Ω—Ç, –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –Ω–∞ –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–∏–Ω–∏–π (`Kafka`).  
–î—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å - ETL - –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–≤–ª–µ–∫–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ Kafka, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤—ã–≤–∞—Ç—å –∏ –ø–∞—á–∫–∞–º–∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Ö –≤ `ClickHouse`.      
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∫ —Å–µ—Ä–≤–∏—Å—É –Ω–∞–ø–∏—Å–∞–Ω—ã —Ç–µ—Å—Ç—ã (Pytest).  

### –ê–≤—Ç–æ—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞:
- –ì–µ–ª—å—Ä—É–¥ –ë–æ—Ä–∏—Å (https://github.com/Izrekatel/)
- –ö–æ—Å—è–Ω–æ–≤ –ù–∏–∫–∏—Ç–∞ (https://github.com/4madeuz/)
- **–•–æ–ª–∫–∏–Ω –°–µ—Ä–≥–µ–π** (https://github.com/Khosep/)

### –ú–æ–π –≤–∫–ª–∞–¥:
1) –ü–µ—Ä–≤–∏—á–Ω–∞—è —Ä–∞–±–æ—á–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è *–∑–∞–≥—Ä—É–∑–∫–∏* –ø–æ—Å—Ç—É–ø–∞—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –≤ Kafka (endpoint, —Å–µ—Ä–≤–∏—Å—ã, KafkaProducer)
2) –†–µ–∞–ª–∏–∑–∞—Ü–∏—è ETL –ø—Ä–æ—Ü–µ—Å—Å–∞:
- **Extact**: *–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ* –¥–∞–Ω–Ω—ã—Ö –∏–∑ Kafka.
- **Transform**: *–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ* –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.
- **Load**: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse.

### –ê–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
https://github.com/Izrekatel/ugc_sprint_1 (–Ω–µ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –≤–µ—Ä–æ—è—Ç–Ω–æ, —Ç.–∫. –∑–∞–∫—Ä—ã—Ç)

### 1. üìñ –ó–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö Docker

#### 1. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª –∏–∑ env.example (–≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ)

#### 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker

#### 3. –ü–æ–¥–Ω–∏–º–∞–µ–º —Å–µ—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤:
```bash
docker-compose -f docker-compose-ugc.yml up -d
```
#### 4. –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞

```
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:
http://localhost:60/ugc/openapi

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –µ–µ —Å–∫–∞—á–∞—Ç—å –≤ –≤–∏–¥–µ json:
http://localhost:60/ugc/openapi.json

```
#### 5. –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
–ü–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫ –ª–æ–≥–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Ç–µ—Å—Ç–æ–≤.
```

### 2. üìñ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
<details>
<summary>
–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Ä–∞—Å–∫—Ä—ã—Ç—å
</summary>>
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Poetry

–î–ª—è Linux, macOS, Windows (WSL):
```bash
curl -sSL https://install.python-poetry.org | python3 -
```

–î–ª—è Windows (Powershell):
```bash
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -
```
–ß—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç—ã –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å, PowerShell –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ—Å–∏—Ç—å —É –≤–∞—Å –ø–æ–º–µ–Ω—è—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏.

–í macOS –∏ Windows —Å—Ü–µ–Ω–∞—Ä–∏–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å –ø–∞–ø–∫—É —Å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º —Ñ–∞–π–ª–æ–º poetry –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PATH. –°–¥–µ–ª–∞–π—Ç–µ —ç—Ç–æ, –≤—ã–ø–æ–ª–Ω–∏–≤ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:

macOS (–Ω–µ –∑–∞–±—É–¥—å—Ç–µ –ø–æ–º–µ–Ω—è—Ç—å borisgelrud –Ω–∞ –∏–º—è –≤–∞—à–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
```bash
export PATH="/Users/borisgelrud/.local/bin:$PATH"
```

Windows
```bash
$Env:Path += ";C:\Users\borisgelrud\AppData\Roaming\Python\Scripts"; setx PATH "$Env:Path"
```

–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â—É—é –∫–æ–º–∞–Ω–¥—É:
```bash
poetry --version
```
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ! –ò–∑–º–µ–Ω–∏—Ç—å –º–µ—Å—Ç–æ–Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞
```bash
poetry config virtualenvs.in-project true
```

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–π bash (–æ–ø—Ü–æ–Ω–∞–ª—å–Ω–æ)
```bash
poetry completions bash >> ~/.bash_completion
```

–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
poetry env use python3.11
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
–í–∞–∂–Ω–æ: poetry —Å—Ç–∞–≤–∏—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç–¥–µ–ª—å–Ω–æ.

–ü–µ—Ä–µ–π—Ç–∏ –≤ –æ–¥–Ω—É –∏–∑ –ø–∞–ø–æ–∫ —Å–µ—Ä–≤–∏—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:
```bash
cd tests
```

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
```bash
poetry install
```

–ó–∞–ø—É—Å–∫ –æ–±–æ–ª–æ—á–∫–∏ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
your@device:~/your_project_pwd/your_service$ poetry shell
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
poetry env list
```


* –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://python-poetry.org/docs/#installation
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è pycharm: https://www.jetbrains.com/help/pycharm/poetry.html


3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pre-commit

–ú–æ–¥—É–ª—å pre-commit —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ lock, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –¥–æ–ª–∂–µ–Ω —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫—É pre-commit –º–æ–∂–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π (–ø—Ä–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏):
```bash
pre-commit --version
```

–ï—Å–ª–∏ pre-commit –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ç–æ –µ–≥–æ –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ https://pre-commit.com/#install

```bash
poetry add pre-commit
```

4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ hook

–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è hook –∫–æ–º–∞–Ω–¥–æ–π
```bash
pre-commit install --all
```

–í –¥–∞–ª—å–Ω–µ–π—à–µ–º –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∫–æ–º–∞–Ω–¥—ã `git commit` –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –≤ —Ñ–∞–π–ª–µ `.pre-commit-config.yaml`.
</details>

